(function(c){var a={OZ:"oz",DSC:"dsc"},b={};b[a.OZ]={showSubmitButton:!0,showPencilIcon:!1,showRichMediaUpload:!0,showVisibilityToggle:!0,enableTwitter:!0,showPreview:!0,showMentions:!0};b[a.DSC]={showSubmitButton:!1,showPencilIcon:!1,showRichMediaUpload:!0,showVisibilityToggle:!1,enableTwitter:!1,showPreview:!0,showMentions:!1};c.exports("sharebox.configTypes",a);c.exports("sharebox.configFactory",function(a){return b[a]||{}})})(LIModules);(function(e){var d=e.requires("underscore"),h=e.requires("dust"),c={},k=["sharebox-static/templates/share","sharebox-static/templates/share-expanded","sharebox-static/templates/share-common/_postmodule","sharebox-static/templates/share-common/_post-module-error-message","sharebox-static/templates/share-common/_postmodule-with-mentions-text-error"],l="sharebox-static/templates/loading sharebox-static/templates/article-preview/share-article-preview sharebox-static/templates/loading-image sharebox-static/templates/article-preview/blocks/articles/side-article sharebox-static/templates/article-preview/blocks/content-description/side-description sharebox-static/templates/article-preview/blocks/entities/carousel-block sharebox-static/templates/article-preview/blocks/images/side-content-image sharebox-static/templates/article-preview/blocks/content-description/side-info-share-box sharebox-static/templates/article-preview/partials/_side-info-share-box sharebox-static/templates/article-preview/partials/_side-image sharebox-static/templates/article-preview/blocks/images/side-content-stock-image sharebox-static/templates/share-common/_editable-description sharebox-static/templates/share-common/_editable-title".split(" "),
f,g;g=c.MissingTemplateError=function(){function a(a){this.missingTemplateNames=a}a.prototype=Object.create(Error.prototype,{constructor:{value:a},name:{value:"MissingTemplateError"},message:{get:function(){return"[sharebox] Missing template(s): "+this.missingTemplateNames.join(", ")}}});return a}();f=c.missingTemplates=function(a){var c=d.keys(h.cache),b=d.toArray(k);a&&(!1!==a.showVisibilityToggle&&b.push("sharebox-static/templates/share-common/_share-to"),!0===a.showPencilIcon&&b.push("sharebox-static/templates/share-common/_create-article"),
!1!==a.showSubmitButton&&b.push("sharebox-static/templates/share-common/_share-button"),!0===a.showRichMediaUpload&&b.push("sharebox-static/templates/share-common/_rich-media-uploader"),a.showPreview&&(b=b.concat(l)));a=d.difference(b,c);return d.isEmpty(a)?!1:a};c.requireTemplates=function(a){if(a=f(a))throw new g(a);};e.exports("sharebox.validateTemplates",c)})(LIModules);(function(){var b=LIModules.requires("underscore");LIModules.exports("Validatable",function(){return{validate:function(){return b.every(this._validations=this._validations||[],function(a){var c=(b.isFunction(a)?a:a.test).call(a);!c&&b.isFunction(a.error)&&a.error();return c})},addValidation:function(a){(this._validations=this._validations||[]).push(a)}}})})();(function(){var a=LIModules.requires("fiber"),b=LIModules.requires("Validatable"),c=a.extend(function(){return{init:function(){a.decorate(this,b)},configure:function(a){this.$root=a._$el;this._module=a},getFormData:function(){return[]},reset:function(){}}});LIModules.exports("PostModulePlugin",c)})();(function(){var g=LIModules.requires("jquery"),b=LIModules.requires("underscore"),f=LIModules.requires("fiber").extend(function(){var h,k,l,m,n;function f(a){return b.map(a,function(a,c){return encodeURIComponent(c)+"\x3d"+encodeURIComponent(a)}).join("\x26")}m="KEEP_POLLING";n="SUCCESS";h="success";k="timeout";l="network-error";return{urlPreviewEndpoint:"/sharing/api/url-preview",urlParamName:"url",pollingInterval:1E3,pollingTimeout:1E4,init:function(a){a&&b.extend(this,b.pick(a,["pollingTimeout",
"pollingInterval","urlParamName","urlPreviewEndpoint"]))},poll:function(a){function p(){e=g.getJSON(t);e.then(f,c)}function c(){"pending"===d.state()&&d.resolve(l)}function f(a){a.status===n?d.resolve(h,a.data):a.status===m?q?d.resolve(k):r=b.delay(p,u):d.reject("unknown status code: "+a.status)}var d=new g.Deferred,q=!1,t=this.buildUrlPreviewUrl(a),u=this.pollingInterval,r,s,e;s=b.delay(function(){q=!0},this.pollingTimeout);p();return b.extend(d.promise(),{abortIfPending:function(){d.resolve("aborted",
void 0);b.each([r,s],clearTimeout);e&&"pending"===e.state()&&e.abort()},isPolling:function(){return"pending"===d.state()}})},buildUrlPreviewUrl:function(a){var b=this.urlPreviewEndpoint,c={};c[this.urlParamName]=a;a=b;b=a.indexOf("?");c=f(c);-1===b?a+="?":b<a.length-1&&(a+="\x26");return a+c}}});LIModules.exports("UrlPreviewPoller",f)})();(function(){var e=LIModules.requires("jquery"),c=LIModules.requires("underscore"),f=LIModules.requires("fiber"),m=LIModules.requires("backbone"),f=f.extend(function(){return{loaderTemplate:"sharebox-static/templates/loading",loaderImgTemplate:"sharebox-static/templates/loading-image",previewTemplate:"sharebox-static/templates/article-preview/share-article-preview",init:function(a){this.isRendered=!1;this.$targetEl=e(a.targetEl);this.eventType=a.eventType||"preview";a&&c.extend(this,c.pick(a,["previewTemplate",
"loaderTemplate"]));c.extend(this,m.Events);this.bindEvents()},bindEvents:function(){var a=this.$targetEl;a.on("click",".dismiss",c.bind(this.dismiss,this));this.on("previewRendered",function(){this.isRendered=!0});this.on("previewDismissed",function(){this.isRendered=!1});e(document).on("previewError",function(){c.delay(function(){a.addClass("hidden")},30)})},createTextArea:function(a){var b=e(a.target),d=b.attr("class");a={value:b.text()};dust.render("sharebox-static/templates/share-common/_editable-"+
d,a,function(a,c){b.before(c).hide();b.parent().find("."+d+"-edit").focus()})},deleteTextArea:function(a){a=e(a.target);var b=a.next(),d=a.val();this.$targetEl.find("."+this.eventType).length&&(a.data("original-text")!==d&&this.trigger(this.eventType+".previewEdited",{name:b.attr("class"),value:d}),b.text(d||a.data("original-text")||a.attr("placeholder")),a.remove(),b.show())},dismiss:function(a){a.preventDefault();this.trigger("userClickedDimiss");this.reset()},removeLoader:function(){this.$targetEl.removeClass("loading").empty()},
render:function(a){var b=this;a&&dust.render(this.previewTemplate,a,function(a,g){var k;b.removeLoader();a||(k=e(g),k.on("click",".content .title",b.createTextArea).on("click",".content .description",b.createTextArea).on("blur",".content .description-edit",c.bind(b.deleteTextArea,b)).on("blur",".content .title-edit",c.bind(b.deleteTextArea,b)),b.$targetEl.append(k),b.isRendered=!0,b.trigger("previewRendered"))})},reset:function(){this.$targetEl.addClass("hidden").removeClass("presentation-expanded");
this.isRendered=!1;c.delay(c.bind(function(){this.removeLoader();this.trigger("previewDismissed")},this),200)},showLoader:function(a){var b=this.$targetEl,d={},g;a&&(d=a.find("#slideshare-file-input")[0].files[0],g=d.type.match(/image.*/));b.addClass("loading");dust.render(g?this.loaderImgTemplate:this.loaderTemplate,{fileName:d.name||""},function(a,c){var f,l,h;g?(h=e(c),l=h.find("img")[0],l.file=d,b.html(h),f=new FileReader,f.onload=function(a){return function(b){var c=new Image;c.onload=function(){h.find(".dimensions").html(this.width+
"px \x26times; "+this.height+"px");e(a).replaceWith(c)};c.src=b.target.result}}(l),f.readAsDataURL(d)):b.html(c)});b.is(".hidden")&&c.delay(function(){b.removeClass("hidden")},20)}}});LIModules.exports("PreviewModule",f)})();(function(){var e=LIModules.requires("jquery"),c=LIModules.requires("underscore"),b=LIModules.requires("PostModulePlugin"),g=LIModules.requires("backbone"),b=b.extend(function(b){var d=LIModules.requires("urlRE");return{textEntrySelector:".postmodule-text",urlRegExp:d,wordDelimiterRegExp:/\s+/,trailingCommaRegExp:/,$/,keyupDebounceTimeout:1E3,init:function(a){var f;b.init.apply(this,arguments);a&&(c.extend(this,c.pick(a,["keyupDebounceTimeout","wordDelimiterRegExp","urlRegExp","textEntrySelector"])),
f=a.keyCodes,this.allUrlsFromTextArea=[]);this.addKeyCodes(f||[32,13,8]);c.extend(this,g.Events);if("undefined"===typeof this.urlRegExp){if("undefined"===typeof d)throw Error("urlRE is not defined");this.urlRegExp=d}},addKeyCodes:function(a){"number"===typeof a&&(a=c.toArray(arguments));this.keyCodes||(this.keyCodes=[]);this.keyCodes=this.keyCodes.concat(a)},configure:function(){b.configure.apply(this,arguments);this.bindEvents()},bindEvents:function(){this.debouncedCheckForUrls||(this.debouncedCheckForUrls=
this.createDebouncedMethod("checkForUrls"))},createDebouncedMethod:function(a){function f(){c.isFunction(b[a])&&b[a].apply(b,d)}var b=this,d,e;return function(){d=arguments;clearInterval(e);e=setTimeout(f,b.keyupDebounceTimeout)}},unbindEvents:function(){this.boundOnKeyupHandler&&(this.$root.off(KEYUP_EVENT_NAME,this.textEntrySelector,this.boundOnKeyupHandler),delete this.boundOnKeyupHandler);this.boundOnPasteHandler&&(this.$root.off(PASTE_EVENT_NAME,this.textEntrySelector,this.boundOnPasteHandler),
delete this.boundOnPasteHandler)},handleTextChanged:function(a,b){if(a)if(a.which)this.onPostModuleKeyup(a);else this.onPostModulePaste(a);else this.checkForUrls(b)},onPostModuleKeyup:function(a){var b=e(a.target);c.contains(this.keyCodes,a.which)?this.checkForUrls(b):this.debouncedCheckForUrls(b)},onPostModulePaste:function(a){a=e(a.target);c.chain(this.checkForUrls).bind(this).defer(a)},checkForUrls:function(a){this.allUrlsFromTextArea=this.extractUrls(a.val());(a=c.first(this.allUrlsFromTextArea))&&
this.trigger("urlFound",a)},isUrl:function(a){return this.urlRegExp.test(a)},extractUrls:function(a){return c.chain(a.split(this.wordDelimiterRegExp)).filter(this.isUrl,this).map(function(a){return a.replace(this.trailingCommaRegExp,"")},this).value()}}});LIModules.exports("UrlDetectorPlugin",b)})();(function(){var e=LIModules.requires("jquery"),b=LIModules.requires("underscore"),f={container:".carousel-block",menu:".image-chooser",slider:".slider"},c;c=LIModules.requires("fiber").extend(function(){return{transitionDuration:200,init:function(a){this._cancelClick=!1;this.currentIndex=0;this.disabled=!1;this._config=b.defaults(a,f);this.$container=e(this._config.container);this.$menu=this.$container.find(this._config.menu);this.$slider=this.$container.find(this._config.slider);this._attachEventListeners();
this.images=this._prepImages();this._updateButtonStatus();this.images.length||this.disable()},disable:function(){this.$container.addClass("killed");this.currentIndex=-1;this.disabled=!0},next:function(){this._advance(this.currentIndex+1)},prev:function(){this._advance(this.currentIndex-1)},_prepImages:function(){return b.map(this.$slider.find("li"),function(a){return{el:a,width:a.offsetWidth}})},_updateButtonStatus:function(){var a=this.$menu.find(".prev .button-arrow"),d=this.$menu.find(".next .button-arrow");
a.prop("disabled",0===this.currentIndex);d.prop("disabled",this.currentIndex===this.images.length-1)},_advance:function(a){var d=this.images.length-1;a=Math.min(Math.max(a,0),d);this.$slider.css("left",-this._offsetAtIndex(a));this.currentIndex=a;this._updateButtonStatus()},_offsetAtIndex:function(a){return b.chain(this.images).first(a).pluck("width").reduce(function(a,b){return a+b},0).value()},_handleDismissClick:function(a){a.preventDefault();a.stopPropagation();this.disable()},_handleNavClick:function(a){var b=
e(a.target).parent(),c=this;a.preventDefault();a.stopPropagation();this._cancelClick||(b.is(".prev")?this.prev():b.is(".next")&&this.next(),this._cancelClick=!0,setTimeout(function(){c._cancelClick=!1},this.transitionDuration))},_attachEventListeners:function(){this.$menu.on("click","button",b.bind(this._handleNavClick,this));this.$container.off().on("click",".dismiss",b.bind(this._handleDismissClick,this))}}});LIModules.exports("ImagePicker",c)})();(function(){try{var a=play.getEmbeddedContent("twitterCallbackData");callbackObj=JSON.parse(decodeURIComponent(a.callback));a.handle&&a.credentialUrn?opener.window[callbackObj.onAllow].call(opener.window[callbackObj.scope],{results:{twitterHandle:a.handle,twitterCrendentialUrn:a.credentialUrn},win:window}):opener.window[callbackObj.onDeny].call(opener.window[callbackObj.scope],{results:{},win:window})}catch(b){}})();(function(){var d=LIModules.requires("underscore"),e=LIModules.requires("UrlDetectorPlugin"),h=LIModules.requires("UrlPreviewPoller"),k=LIModules.requires("PreviewModule"),l=LIModules.requires("ImagePicker"),e=e.extend(function(e){function g(b,a,c){a=a.toLowerCase();if(a===f.SUCCESS)return b(c);a!==f.TIMEOUT&&a!==f.NETWORK_ERROR||this.reset()}var f={SUCCESS:"success",TIMEOUT:"timeout",NETWORK_ERROR:"network-error"};return{init:function(b){e.init.apply(this,arguments);b=b||{};d.extend(this,d.pick(b,
["transformJson"]));this.urlPreviewPoller=new h(b.poller);this.previewModule=new k(b.preview);this.renderPreview=d.bind(function(){this.render.apply(this,arguments);this.imagePicker=new l({container:"#article-preview-container .carousel-block"})},this.previewModule);this.previewModule.on(b.preview.eventType+".previewEdited",d.bind(this.updatePreviewData,this));this.addValidators()},addValidators:function(){var b=this;this.addValidation({test:function(){return!b.isPolling},error:function(){}})},bindEvents:function(){e.bindEvents.apply(this,
arguments);this.on("urlFound",this.onUrlFound);this.previewModule.on("previewDismissed",function(){delete this.json},this)},getCurrentArticle:function(){return this.json},getFormData:function(){var b=[],a;this.hasArticlePreview()&&(a=this.getCurrentArticle().content[0],b=[{name:"content.id",value:a.id},{name:"content.url",value:a.url},{name:"content.resolvedUrl",value:a.resolvedUrl},{name:"content.title",value:a.title?a.title.substr(0,200):""},{name:"content.description",value:a.description?a.description.substr(0,
250):""},{name:"content.authorData",value:a.authorData},{name:"content.contentType",value:a.contentType}],!this.previewModule.imagePicker.disabled&&(a.previewImages&&a.previewImages.length)&&(a=a.previewImages[this.previewModule.imagePicker.currentIndex],b=b.concat([{name:"content.image.url",value:a.url},{name:"content.image.width",value:a.width},{name:"content.image.height",value:a.height},{name:"content.image.size",value:a.size}])));return b},hasArticlePreview:function(){return void 0!==this.json},
onUrlFound:function(b){var a=this,c=this.request;this.hasArticlePreview()||(c&&(c.abortIfPending(),delete this.json),this.previewModule.showLoader(),c=this.request=this.urlPreviewPoller.poll(b),d.extend(this.request,this.previewModule),this.isPolling=!0,c.done(d.wrap(function(b){a.json=b},g)),c.always(function(){a.isPolling=!1}),c.then(d.wrap(this.transformJson,g)).then(this.renderPreview))},reset:function(){this.previewModule.reset();delete this.json;this.request&&this.request.abortIfPending()},
transformJson:function(b){return b},updatePreviewData:function(b){this.json&&(this.json.content[0][b.name]=b.value)}}});LIModules.exports("UrlPreviewPlugin",e)})();(function(){LIModules.requires("jquery");var c=LIModules.requires("underscore"),d=LIModules.requires("BaseControl").extend(function(){return{attachEventListeners:function(){this._$el.on("scroll",c.bind(this.onScrollHandler,this))},grow:function(a){var b=a.prop("scrollHeight");b>a.innerHeight()&&a.innerHeight(b)},onScrollHandler:function(a){this.grow(this._$el)}}});LIModules.exports("ExpandingTextEntry",d)})();(function(){var f=LIModules.requires("jquery"),m=LIModules.requires("underscore"),h=LIModules.requires("BaseControl"),u=LIModules.requires("Genie"),h=h.extend(function(k){function h(a){var c={};a&&(a=a.split("\x26"),f.each(a,function(a,d){d=d.split("\x3d");d[0]=decodeURIComponent(d[0]);c[d[0]]=d[1]?decodeURIComponent(d[1]):null}));return c}function t(a,c,b){var d;a=(a||"").split("?");a={base:a[0],query:a[1]||""};d=h(a.query);d[c]=b;a.query="";for(var e in d)a.query&&(a.query+="\x26"),a.query+=encodeURIComponent(e)+
"\x3d"+encodeURIComponent(d[e]);return a.base+"?"+a.query}function v(){var a=this._$el,c=a.val();a.data("selected-option",c);c===g?this.isTethered?this._addTwitterFormFields():this.twitterTetherUrlViaNSettings?this._twitterBindViaNSettings():this.genie.handleClick(a):this.partialRendered&&this._removeTwitterFormFields()}var g="TWITTER",l="PUBLIC";k="oid_cb_"+(new Date).getTime();var n=k+"_allow",p=k+"_deny",q=k+"_error",r=k+"_close",s=k+"_scope";return{popupWidth:790,popupHeight:580,scope:window,
windowLaunched:!1,windowInterval:null,isTethered:!0,partialRendered:!1,popupWindow:null,attachEventListeners:function(){this._$el.on("change",m.bind(v,this))},beforeDecoration:function(){function a(a,b){this.genie._popupWindow=null;c.data("selected-option",l).val(l).change();a&&a.win&&a.win.close()}var c=this._$el,b=f("#share-with-twitter");this.twitterTetherUrl=b.data("twitter-tether-url");this.twitterTetherUrlViaNSettings=b.data("twitter-tether-url-via-nsettings");this.twitterTetherUrl&&(this.isTethered=
!1,this.genie=new u(c[0],{url:this.twitterTetherUrl,handleClickManual:!0,onAllow:function(a,e){a.win.close();a&&a.results&&(this._renderPartial(a.results),c.data("selected-option",g),b.data("twitter-providerid",a.results.tetheredAccountId),b.text(b.text()+" ("+a.results.tetheredAccountHandle+")"),this.isTethered=!0)},onDeny:m.bind(a,this),onError:m.bind(a,this),onClose:m.bind(a,this),scope:this}));this.twitterTetherUrlViaNSettings&&(this.isTethered=!1)},_addTwitterFormFields:function(){this.partialRendered||
this._renderPartial({provider:g,tetheredAccountId:f("#share-with-twitter").data("twitter-providerid")});f(this._$el).data("selected-option",g)},_removeTwitterFormFields:function(){this._$el.parent().find('input[name^\x3d"dist.external"]').remove();f("#share-with-twitter").val(g);this.partialRendered=!1},_renderPartial:function(a){var c=this,b=this._$el;dust.render("sharebox-static/templates/share-common/_external-provider-form-details",{provider:a.provider,providerId:a.tetheredAccountId},function(a,
e){b.after(e);c.partialRendered=!0});f("#share-with-twitter").val(l)},_cleanupWindowCallbacks:function(){window[n]=null;window[p]=null;window[q]=null;window[r]=null;window[s]=null;this.windowLaunched=!1;clearInterval(this.windowInterval);this.windowInterval=null},_handleCancel:function(a){this._cleanupWindowCallbacks();a&&a.win&&a.win.close();a=this._$el;this.popupWindow=null;a.data("selected-option",l).val(l).change()},_createWindowCallbacks:function(){var a=this._$el,c=f("#share-with-twitter");
this._cleanupWindowCallbacks();window[n]=function(b){this._cleanupWindowCallbacks();this.popupWindow=null;b.win.close();if(b&&b.results){b.results.provider=g;var d=b.results,e;e=(e=b.results.twitterCrendentialUrn)&&e.indexOf(";")?e.split(";")[1]:void 0;d.tetheredAccountId=e;this._renderPartial(b.results);a.data("selected-option",g);c.data("twitter-providerid",b.results.tetheredAccountId);c.text(c.text()+" ("+b.results.twitterHandle+")");this.isTethered=!0}};window[p]=function(a){this._handleCancel(a)};
window[q]=function(a){this._handleCancel(a)};window[r]=function(a){this._handleCancel(a)};window[s]=this},_twitterBindViaNSettings:function(){callbackInfo=JSON.stringify({onAllow:n,onDeny:p,onError:q,onClose:r,scope:s});returnUrl=h(this.twitterTetherUrlViaNSettings.split("?")[1]).url;returnUrl=t(returnUrl,"cb",callbackInfo);this.twitterTetherUrlViaNSettings=t(this.twitterTetherUrlViaNSettings,"url",returnUrl);this._createWindowCallbacks();this.popupWindow=window.open(this.twitterTetherUrlViaNSettings,
"nsettings_popup","width\x3d"+this.popupWidth+",height\x3d"+this.popupHeight);this.windowLaunched=!0;this.windowInterval=setInterval(function(){this.windowLaunched&&(this.popupWindow&&this.popupWindow.closed)&&this._handleCancel({win:this.scope})}.bind(this),300)}}});LIModules.exports("TwitterTethering",h)})();(function(){var c=LIModules.requires("jquery"),f=LIModules.requires("underscore"),g=LIModules.requires("PostModulePlugin").extend(function(e){return{maxCharacters:600,twitterMaxCharacters:140,shortUrlLength:24,init:function(a){e.init.apply(this,arguments);this.$el=c(a.rootSelector);this.$textarea=c(a.textAreaSelector);this.$selectBox=c("#share-with-combo-select",this.$el);this.dustTmpl=a.dustTmpl||"sharebox-static/templates/share-common/_postmodule-text-count-error";this._initializeEvents();this.isValid=
!0;this.twitterEnabled=!1;this.messageType="error"},addValidator:function(){var a=this;this.addValidation({test:function(){return a.isValid},error:function(){}})},configure:function(a){e.configure.call(this,a);this.$submitButton=this.$root.find(".postmodule-submit");this.addValidator()},reset:function(){this.$el.find(".post-module-text-error .text-count-error").empty()},handleTextChanged:function(a,b){var d=this._getTextCountWithUrls(a,b);this._validate(d)},getIsValid:function(){return this.isValid},
_initializeEvents:function(){var a=this;a.$selectBox.on("change",function(){a.twitterEnabled="TWITTER"===c(this).data("selected-option");a.twitterEnabled||"info"!==a.messageType||a.$el.find(".post-module-text-error .text-count-error").html("")})},_renderPartial:function(a){var b=this.$el;this.twitterEnabled&&this.isValid?(a={charsLeft:a,typeOfMessage:"info"},this.messageType="info"):(a={charsLeft:a,typeOfMessage:"error"},this.messageType="error");dust.render(this.dustTmpl,a,function(a,c){b.find(".post-module-text-error .text-count-error").replaceWith(c)})},
_validate:function(a){var b,d=this.isValid;(this.isValid=a<=this.maxCharacters)?this.twitterEnabled&&(b=a):b=a-this.maxCharacters;d!==this.isValid&&this.$el.trigger("validationChange");this._renderPartial(b)},_getTextCountWithUrls:function(a,b){var d=this.$textarea.val().replace(/\n/g,"\r\n");return this._getTextWithoutUrls(a,d).length+this.shortUrlLength*b},_getTextWithoutUrls:function(a,b){return f.reduce(a,function(a,b){return a.replace(b,"")},b)}}});LIModules.exports("TextCountPlugin",g)})();(function(){var e=LIModules.requires("jquery"),c=LIModules.requires("underscore"),d=LIModules.requires("PostModulePlugin"),f=LIModules.requires("PreviewModule"),g=LIModules.requires("Events"),d=d.extend(function(d){return{init:function(a){d.init.apply(this,arguments);this.$el=e(a.rootSelector);this.$textarea=e(a.textAreaSelector);this.previewModule=new f(a.preview);this.textCountPlugin=a.textCountPlugin;this.urlPreviewPlugin=a.urlPreviewPlugin;a.richMediaPlugin&&(this.richMediaPlugin=a.richMediaPlugin)},
getPlugins:function(){return c.compact([this.urlPreviewPlugin,this.textCountPlugin])},getFormData:function(){return c.reduce(this.getPlugins(),function(a,b){return a.concat(b.getFormData())},[])},configure:function(){var a=c.toArray(arguments);c.each(this.getPlugins(),function(b){b.configure.apply(b,a)});this._initializeEvents()},_initializeEvents:function(){this.$textarea.on("keyup",c.throttle(c.bind(this._textChanged,this),50)).on("paste",c.bind(this._paste,this));this.urlPreviewPlugin.previewModule.on("previewRendered",
c.bind(this._previewChanged,this));g.bind("changed",c.bind(this._uploadStateChanged,this));this.previewModule.on("previewDismissed",this._previewChanged,this)},_uploadStateChanged:function(a){var b=this.richMediaPlugin.slideshareUploader.STATE;switch(a[0]){case b.UploadImageComplete:case b.UploadConvertEnd:case b.UploadPreview:this._previewChanged()}},_paste:function(a){setTimeout(c.bind(function(){this._textChanged(a)},this),1)},_textChanged:function(a){var b=this._getRichMediaUrl();c.isArray(b)&&
!b.length&&this.urlPreviewPlugin.handleTextChanged(a,this.$textarea);a=this._getUniqueUrls();b=this.urlPreviewPlugin.allUrlsFromTextArea;this.textCountPlugin&&this.textCountPlugin.handleTextChanged(b,a.length)},_previewChanged:function(a){a=this._getUniqueUrls();var b=this.urlPreviewPlugin.allUrlsFromTextArea;this.textCountPlugin&&this.textCountPlugin.handleTextChanged(b,a.length)},_getUniqueUrls:function(){var a=this.urlPreviewPlugin.allUrlsFromTextArea,b=this._getArticleUrlFromPreview(),d=this._getRichMediaUrl();
return c.union(a,b,d)},_getArticleUrlFromPreview:function(){var a=this.urlPreviewPlugin.getCurrentArticle(),b=[];a&&(a.content&&0<a.content.length&&"article"===a.content[0].contentType)&&b.push(a.content[0].url);return b},_getRichMediaUrl:function(){var a=this.richMediaPlugin&&this.richMediaPlugin.richMediaJson,b=[],c;if(a)switch(c=a.uploadType,c){case "presentation":a.presentationDetails&&b.push(a.presentationDetails.url);break;case "document":a.documentDetails&&b.push(a.documentDetails.title);break;
case "image":a.imageDetails&&b.push(a.imageDetails.url)}return b}}});LIModules.exports("TextUpdateManager",d)})();(function(){var c=LIModules.requires("jquery"),d=LIModules.requires("underscore"),b=LIModules.requires("fiber"),e=LIModules.requires("ModalDialogBox"),b=b.extend(function(){return{errorDisplayed:!1,init:function(a){this.errorTemplate=a.errorTemplate;this.targetSelector=a.targetSelector;this.$target=c(this.targetSelector)},displayErrorMessage:function(a){var b,c;this.errorDisplayed||(b=a.data||{},c=a.template||this.errorTemplate,dust.render(c,b,d.bind(function(b,c){b||(this.$target.append(c),this.errorDisplayed=
!0,a.dialog&&this._errorDialogConstructor(a.dialog),d.isFunction(a.callback)&&a.callback())},this)))},removeErrorMessage:function(){this.$target.empty();this.errorDisplayed=!1;this.errorMessageDialog&&(this.errorMessageDialog.destroy(),this.errorMessageDialog=null)},_errorDialogConstructor:function(a){this.errorMessageDialog=new e(c(a.el),{title:a.title||"",decorators:["scripts/shared/Dialog/AjaxDustTemplateLoading"],dustContentTemplateData:a.data||{},dustContentTemplate:a.template})}}});LIModules.exports("ErrorMessageModule",
b)})();(function(q){var m=LIModules.requires("jquery"),f=LIModules.requires("underscore"),p=LIModules.requires("fiber"),z=LIModules.requires("Events"),s=LIModules.requires("i18n"),A=LIModules.requires("htmlUnencode"),l={CONVERT:"convert",TYPE:"type",SIZE:"size",PROGRESS:"progress",HALT:"halt",HEALTH:"health"},B={upload_active:"act",upload_error:"err",upload_error_convert:"err-cnvr",upload_error_halt:"err-halt",upload_error_health:"err-hlth",upload_error_iframe:"err-ifrm",upload_error_progress:"err-pgrs",
upload_error_size:"err-fsiz",upload_error_type:"err-ftyp",upload_cancel:"cncl",upload_cancel_convert:"cncl-cnvr",upload_cancel_error:"cncl-err",upload_cancel_preview:"cncl-prvw",upload_cancel_upload:"cncl-upld",upload_progress_start:"ustart",upload_progress_end:"uend",upload_convert_start:"cstart",upload_convert_end:"cend",upload_icon_click:"clck",upload_file_upload:"sbmt",upload_preview:"prvw",upload_complete:"fcmpt",upload_image_complete:"icmpt"},d={UploadActive:"upload_active",UploadError:"upload_error",
UploadCancel:"upload_cancel",UploadProgressStart:"upload_progress_start",UploadProgressStatus:"upload_progress_status",UploadProgressEnd:"upload_progress_end",UploadFileComplete:"upload_complete",UploadImageComplete:"upload_image_complete",UploadQueueStart:"upload_queue_start",UploadQueueStatus:"upload_queue_status",UploadQueueEnd:"upload_queue_end",UploadConvertStart:"upload_convert_start",UploadConvertStatus:"upload_convert_status",UploadConvertEnd:"upload_convert_end",UploadPreview:"upload_preview",
UploadConvertThresholdOne:"upload_convert_threshold_one",UploadConvertThresholdTwo:"upload_convert_threshold_two",FileFocus:"file_focus",FileBlur:"file_blur",InteractiveLocked:"interactive_locked",InteractiveUnlocked:"interactive_unlocked"},h,k={now:Date.now||function(){return+new Date},generateValidExtensions:function(b,a){var c={jpeg:"image",jpg:"image",gif:"image",png:"image",pdf:"document",doc:"document",docx:"document",rtf:"document",odt:"document",ppt:"presentation",pps:"presentation",pptx:"presentation",
ppsx:"presentation",pot:"presentation",potx:"presentation",odp:"presentation"},e={},g;b&&(g=f.difference(f.keys(c),[].concat(b)),e=f.omit(c,g));a&&(g=[].concat(a),f.each(c,function(a,c){f.contains(g,a)&&(e[c]=a)}));this.extensions=f.isEmpty(e)?c:e},substituteString:function(b,a){var c=b.match(/\{.*?\}/g);return f.reduce(c,function(c,b){var d=a[b.slice(1,-1)];return c.replace(b,void 0===d?b:d)},b)},i18n:function(b){s.get&&(b=s.get(b));return b},getFileExtension:function(b){return f.last(b.split(".")).toLowerCase()},
determineFileType:function(b){b=this.getFileExtension(b);return this.i18n("slideshare-uploader-"+(k.extensions[b]||"unknown"))||""},isSameHostRegex:RegExp("^(https?:)?\\/\\/"+q.location.host.replace(/\./g,"[.]")+"\\/?","i"),request:function(b,a,c){function e(a){var b=this;return function(e){var g={};if(e){e=e.content;try{g=JSON.parse(A(e))}catch(d){c();return}}a.call(b,g,e)}}var g=0===b.indexOf("//")||0===b.indexOf("http"),d=null!==b.match(this.isSameHostRegex);g&&!d?m.ajax({url:b,jsonp:"jsonp_callback",
dataType:"jsonp"}).done(a).fail(c):m.ajax({type:"GET",headers:{"X-IsAJAXForm":"1"},url:b}).done(e(a)).fail(e(c))}},u=p.extend(function(){var b={convert:"/nhome/slideshare/convert-upload",status:"/nhome/slideshare/get-convert-status",slideshow:"/nhome/slideshare/get-slideshow",imageStore:"http://image-store.slidesharecdn.com/",progressPrefix:"_"};return{init:function(a){this._config=f.defaults(a||{},b);this.progressId=this._config.progressPrefix+k.now()+Math.random();this.timer=new t(this._config.monitor)},
update:function(a){f.extend(this._config,a);return this},updateTimer:function(){var a=this.timer;return a?a.update.apply(a,arguments):this},getProgressUrl:function(){return this._config.base+"/progress?X-Progress-ID\x3d"+this.progressId},getHealthCheckUrl:function(a){var c=this._config.base+"/health_check";return a?c:c+"?X-Progress-ID\x3d"+this.progressId+"\x26jsonp_callback\x3dvoid\x26iframe_jsonp\x3dtrue\x26window_post\x3dtrue\x26post_window\x3dparent"},getUploadUrl:function(){var a="SlideshareUploader"+
this._config.progressPrefix+k.now();if(!/^\w+$/g.test(a))throw Error();LI[a]=function(c,b){return function(){delete LI[a];c.apply(b,arguments)}}(this._uploadCallback,this);return this._config.base+"/upload?X-Progress-ID\x3d"+this.progressId+"\x26iframe_jsonp\x3dtrue\x26window_post\x3dtrue\x26post_window\x3dparent\x26jsonp_callback\x3d"+a},getConvertUrl:function(){return this._config.convert.replace("*",this.fileId)},getConvertStatusUrl:function(){return this._config.status.replace("*",this.slideshowId)},
getPreviewUrl:function(){return this._config.slideshow.replace("*",this.slideshowId)},getImageUploadUrl:function(){var a=this.fileId.split(".");return this._config.imageStore+a[0]+"-large."+a[1]},generateFile:function(a){a=document.getElementById(a);this.name=a.value.replace(/\\/g,"/").split(/\//g).pop();this.size=a.files&&a.files[0]&&a.files[0].size;this.ext=k.getFileExtension(this.name);this.type=k.extensions[this.ext]||"unknown";return this},isImage:function(){return"image"===this.type},isValidSize:function(a){var c=
this.size;return void 0===c||c&&c<=a},isValidType:function(a){this.updateTimer({type:this.ext});return(a||!a&&"image"!==this.type)&&k.extensions.hasOwnProperty(this.ext)},_uploadCallback:function(a){function c(a){a&&"fail"!==a.status?h.state(d.UploadFileComplete,a):b(a)}function b(a){h.state(d.UploadError,{type:l.CONVERT})}this.fileId=a.file_key;h.state(d.UploadProgressEnd,a);"image"===this.type?h.state(d.UploadImageComplete,{image:this.getImageUploadUrl(),extension:this.ext,type:k.determineFileType(this.ext),
id:this.fileId,url:this.getImageUploadUrl()}):k.request(this.getConvertUrl(),c,b)}}}),t=p.extend(function(){return{init:function(b){this.times={start:{},end:{}};this.url=b;this.currentState=""},reset:function(){this.times={start:{},end:{}};delete this.action;delete this.result;delete this.type;return this},update:function(b,a){var c="string"===typeof b;f.extend(this,c?a:b);return c?this._chain(b):this},start:function(b){b!==this.currentState&&this.update({action:b});this.currentState=b=b||"unknown";
this.times.start[b]=k.now();return this._chain(b)},end:function(b){b=b||"unknown";this.times.end[b]=k.now();return this._chain(b)},send:function(b,a){var c="string"===typeof b,e=(c?b:b&&b.state)||"unknown",g=(this.times.end[e]||k.now())-this.times.start[e];c&&(b=a||{});if(!this.url||isNaN(g))return this;c=k.substituteString("\x26fileAction\x3d{action}\x26actionResult\x3d{result}\x26time\x3d{time}\x26fileType\x3d{type}",{action:e||b.action||this.action||"unknown",result:b.result||this.result||"unknown",
time:g,type:b.type||this.type||"unknown"});m.get(this.url+c);return this._chain(e)},_chain:function(b){function a(a){return function(g){var d="string"!==typeof g,h=[].slice.call(arguments,d?0:1);return c[a].apply(c,[d?b:g].concat(h))}}var c=this;return{reset:a("reset"),update:a("update"),start:a("start"),end:a("end"),send:a("send")}}}}),r=p.extend(function(){return{init:function(b){this.url=b;this.failureCount=0;this.isKilled=!1;this.run()},kill:function(){this.isKilled=!0;q.clearTimeout(this.timeout)},
run:function(){this.isKilled||(this.timeout=q.setTimeout(f.bind(this.sendRequest,this),1E3))},success:function(b){b=this._successCallback(b);this.failureCount=0;b&&this.run()},failure:function(b){var a=!0;3<=++this.failureCount&&(a=this._failureCallback(b));a&&this.run()},sendRequest:function(){k.request(this.url,f.bind(this.success,this),f.bind(this.failure,this))},_successCallback:function(){},_failureCallback:function(){}}}),v=r.extend(function(b){return{init:function(a){this.sameSizeCount=this.previousUploadSize=
0;this.percentageText=k.i18n("slideshare-uploader-percentage");this._setUploadProgressStatus(0);b.init.apply(this,arguments)},_setUploadProgressStatus:function(a){h.state(d.UploadProgressStatus,{percentage:k.substituteString(this.percentageText,{0:a})})},failure:function(a){var c=!0,b=a.status;if(3<=++this.failureCount||413===b||415===b||500===b)c=this._failureCallback(a);c&&this.run()},_successCallback:function(a){var c=!0,b=a.state,g=a.received||0,n=Math.max(0,Math.round(100*(g/(a.size||0))))||
0;if(g&&g<=this.previousUploadSize){if(30<=++this.sameSizeCount)return this.failure({errorType:l.HALT})}else this.sameSizeCount=0;this.previousUploadSize=g;if("starting"===b||"uploading"===b)this._setUploadProgressStatus(n),100===n&&(c=!1,h.state(d.UploadProgressEnd,a));else if("done"===b)this._setUploadProgressStatus(100),c=!1,h.state(d.UploadProgressEnd,a);else return this.failure(a);return c},_failureCallback:function(a){var b=a&&a.status;h.state(d.UploadError,{type:413===b?l.SIZE:415===b?l.TYPE:
a&&a.errorType||l.PROGRESS});return!1}}}),w=r.extend(function(b){return{init:function(a){b.init.apply(this,arguments)},_successCallback:function(a){function b(c){h.state(c,a)}var e=a.state,g=[d.UploadFileComplete,d.UploadQueueStatus,d.UploadQueueStart],n=!0;if(0===e)b(d.UploadQueueStatus);else if(1===e)-1<f.indexOf(g,h.state())?(b(d.UploadQueueEnd),b(d.UploadConvertStart)):b(d.UploadConvertStatus);else if(2===e)n=!1,b(d.UploadConvertEnd);else if(3===e)return this.failure(a);return n},_failureCallback:function(a){h.state(d.UploadError,
{type:l.CONVERT});return!1}}}),x=p.extend(function(){var b;return{init:function(){f.extend(this,z)},state:function(a,c){if(arguments.length)this.fire("changed",[a,b,c||[]]),b=a;else return b},onChanged:function(a){this.on("changed",a)},STATE:d}}),y=p.extend(function(){var b={transportName:"slideShareIframeTransport",paths:{},fileInputId:"",domain:document.domain.split(".").slice(-3).join("."),slideshareDomain:"",enableImageUpload:!0,checkSize:!0,maxFileSize:104857600,enableTranscriptAsDescription:!0,
enableHealthCheck:!1,trackingPrefix:"ssu-"};return{init:function(a,c){this._el=a;this._config=c=f.defaults(c||{},b);a.id||(a.id=f.uniqueId("slideshare-upload-form-"));a.setAttribute("target",c.transportName);c.domain=document.location.hostname;c.slideshareDomain||(c.slideshareDomain="//slideshare."+c.domain);k.generateValidExtensions(c.acceptedExtensions,c.acceptedTypes);this.createSlideshareUpload();this.uploadIframe=this._createTransport();a.appendChild(this.uploadIframe);this._attachListeners()},
track:function(a){(a=B[a])&&q.WebTracking&&WebTracking.trackUserAction(this._config.trackingPrefix+a)},createSlideshareUpload:function(){var a=this._config;this.currentUpload=(new u({base:a.slideshareDomain,progressPrefix:a.progressPrefix,monitor:a.paths&&a.paths.monitor})).update(a.paths)},killPoll:function(){this.currentPoll&&this.currentPoll.kill()},reset:function(){this._el.reset()},getSlideshowPreview:function(){function a(a){h.state(d.UploadError,{type:l.CONVERT})}var b=this._config.enableTranscriptAsDescription;
k.request(this.currentUpload.getPreviewUrl(),function(e){var g=e.content&&e.content.Slideshow,n=e.transcript&&e.transcript.transcript_body,f=b&&n,l=q.location.protocol;g?h.state(d.UploadPreview,{title:g.Title,summary:f&&n||g.Description,image:(0===g.ThumbnailURL.indexOf("http")?"":l)+g.ThumbnailURL,extension:g.Format,type:k.determineFileType(g.Format),id:g.ID,url:g.SlideshowEmbedUrl}):a(e)},a)},_attachListeners:function(){h.hasListeners||(m(q).on("message",f.bind(this._onMessage,this)),m(this._el).on("submit",
f.bind(this._onFileUploadSubmit,this)).on("reset",f.bind(this._onFormReset,this)),m("#"+this._config.fileInputId).on("change",f.bind(this._onFileSelect,this)).on("click",f.bind(this._onFileClick,this)).on("focus",f.bind(this._onFileFocus,this)).on("blur",f.bind(this._onFileBlur,this)),h.onChanged(f.bind(this._onStateChange,this)),h.hasListeners=!0)},_onMessage:function(a){if((a=a.originalEvent)&&(a.source===this.uploadIframe.contentWindow&&"message"===a.type&&(a.origin==="https:"+this._config.slideshareDomain||
a.origin==="http:"+this._config.slideshareDomain))&&(a=JSON.parse(a.data),"slidesharestatus"===a.type))LI[a.method](a.payload)},_onFileUploadSubmit:function(){this.track("upload_file_upload")},_onFormReset:function(){this.createSlideshareUpload();this.killPoll();h.state(d.InteractiveUnlocked)},_onFileSelect:function(){function a(a){h.state(d.UploadError,{type:a})}var b=this._config,e=this.currentUpload.generateFile(b.fileInputId),g=this._el;h.state(d.UploadActive,{isImageUpload:e.isImage(),type:e.type});
b.checkSize&&!e.isValidSize(b.maxFileSize)?a(l.SIZE):e.isValidType(b.enableImageUpload)?this._checkNodeHealth(function(b){b?(g.setAttribute("action",e.getUploadUrl()),g.submit(),h.state(d.UploadPreview,{track:e.isImage(),title:e.name,type:k.determineFileType(e.name)})):a(l.HEALTH)}):a(l.TYPE)},_onFileClick:function(){this.track("upload_icon_click")},_onFileFocus:function(){h.state(d.FileFocus)},_onFileBlur:function(){h.state(d.FileBlur)},_onStateChange:function(a){var b=a[0];a=a[2]||{};var e=a.type||
"",g=this.currentUpload,f=g.timer;a.track&&!1!==a.track&&this.track(b);switch(b){case d.UploadActive:this.currentPoll=new v(g.getProgressUrl());f.reset();h.state(d.InteractiveLocked);h.state(d.UploadProgressStart,[]);break;case d.UploadProgressStart:f.start("upload");break;case d.UploadProgressEnd:this.killPoll();this._registerThresholdCallbacks();break;case d.UploadImageComplete:f.update({result:"succeed"}).end("upload").send().reset();break;case d.UploadFileComplete:g.slideshowId=a.slideshow_id;
h.state(d.UploadQueueStart,[]);f.update({result:"succeed"}).end("upload").send();this.currentPoll=new w(g.getConvertStatusUrl());break;case d.UploadQueueStart:f.start("queue");break;case d.UploadQueueEnd:f.update({result:"succeed"}).end("queue").send();break;case d.UploadConvertStart:f.start("convert");break;case d.UploadConvertEnd:this.killPoll();this.getSlideshowPreview();f.update({result:"succeed"}).end("convert").send().reset();break;case d.UploadError:this.killPoll(),this.reset(),e!==l.TYPE&&
e!==l.SIZE||f.reset(),f.send(f.action,{result:"failed"}),e&&this.track("upload_error_"+l[e.toUpperCase()])}},_buildIFrame:function(a){var b=document.createElement("iframe");b.style.display="none";b.frameborder="none";b.height=0;b.width=0;b.src=a;return b},_createTransport:function(){var a=this._config.enableHealthCheck&&this.currentUpload?this.currentUpload.getHealthCheckUrl():"about:blank",b=this._buildIFrame(a),d=m(this._el);b.name=this._config.transportName;b.className="slideshare-upload-iframe";
m(b).on("load",function n(){m(b).off("load",n);d.addClass("is-ready")});return b},_checkNodeHealth:function(a){function b(c){h&&h.parentNode&&(h.parentNode.removeChild(h),h=null);clearTimeout(k);a(c)}function d(){b(!1)}var g=this,f=g.currentUpload&&g.currentUpload.getHealthCheckUrl(),h,k;a=a||function(){};(function(){(h=f&&g._buildIFrame(f))?(m(h).on("load",function(){b(!0)}),document.body.appendChild(h),k=setTimeout(d,1E4)):d()})()},_registerThresholdCallbacks:function(){var a=this._config.convertTimeThresholds,
b,e=function(a,b){"string"===typeof a&&(a=a.match(/\d+/))&&(a=parseInt(a[0],10));b&&(a&&!isNaN(a))&&q.setTimeout(function(){h.state(b,[])},1E3*a)};for(b in a)a.hasOwnProperty(b)&&e(a[b],d[b])}}}),p=p.extend(function(){return{init:function(b,a){h=this.stateManager=h||new x;this._uploader=new y(b,a);this._el=b;this.STATE=d;this.attachStateMonitor=f.bind(h.onChanged,h);this.reset()},cancelState:function(){var b=this._uploader,a=b.currentUpload.timer;b.killPoll();a.send(a.action,{result:"cancelled"})},
reset:function(){this._uploader.reset()}}});p._={Util:k,SlideshareUpload:u,Timer:t,Poll:r,UploadProgressPoll:v,ConversionProgressPoll:w,StateManager:x,SlideshareUploader:y};LIModules.exports("SlideshareUploader",p)})(window);(function(){var e=LIModules.requires("jquery"),f=LIModules.requires("underscore"),h=LIModules.requires("PostModulePlugin"),k=LIModules.requires("SlideshareUploader"),l=LIModules.requires("Events"),m=LIModules.requires("ErrorMessageModule"),n=LIModules.requires("PreviewModule");LIModules.requires("ModalDialogBox");h=h.extend(function(h){var p={imageTemplate:"sharebox-static/templates/article-preview/share-image-preview",documentTemplate:"sharebox-static/templates/article-preview/share-document-preview",
presentationTemplate:"sharebox-static/templates/article-preview/share-presentation-preview",presentationCondensedTemplate:"sharebox-static/templates/article-preview/share-presentation-condensed",memberId:""};return{isValid:!0,isPreviewRendered:!1,init:function(a){var c;h.init.apply(this,arguments);this._config=f.extend(a||{},p);f.has(this._config,"progressPrefix")?c=this._config.progressPrefix:f.has(this._config,"memberId")&&(c="ss"+this._config.memberId);this.$slideshareForm=e(this._config.$slideshareUploaderForm);
this.slideshareUploader=new k(this.$slideshareForm[0],{progressPrefix:c,paths:{convert:"/nhome/slideshare/convert-upload?fileKey\x3d*\x26shareOnSS\x3dfalse",status:"/nhome/slideshare/get-convert-status?slideshowId\x3d*",slideshow:"/nhome/slideshare/get-slideshow?slideshowId\x3d*\x26truncationLength\x3d250",monitor:"/nhome/slideshare/set-stats?trk\x3dss-setstat"},fileInputId:this._config.fileInputId,convertTimeThresholds:{UploadConvertThresholdOne:"Seconds_60",UploadConvertThresholdTwo:"Seconds_120"}});
this.richMediaJson={};this._config.preview.eventType="rich-media";this.previewModule=new n(this._config.preview);this.previewModule.on("previewDismissed",f.bind(function(){this.$slideshareForm.removeClass("is-active");this.richMediaJson={};this.isPreviewRendered=!1},this)).on("rich-media.previewEdited",f.bind(this.updatePreviewData,this)).on("userClickedDimiss",f.bind(this.resetSlideshareUploader,this));this.addValidators();this.attachEventListeners()},addValidators:function(){var a=this;this.addValidation({test:function(){return a.isValid},
error:function(){}})},attachEventListeners:function(){l.bind("changed",f.bind(this.displayRichMedia,this))},constructDocumentPresentationJson:function(a){return{blocks:[{template:"rich-media/"+this.richMediaJson.uploadType,blocks:[{template:"images/side-content-image",image:a.image,title:a.title,url:a.url},{template:"content-description/side-description",blocks:[{template:"content-description/"+("document"===this.richMediaJson.uploadType?"side-document-info":"side-info"),title:a.title,url:a.url,description:a.summary}]}]}]}},
constructImageJson:function(a){var c=this.richMediaJson.availableSizes.small;return{blocks:[{template:"shared-image",image:a.image.replace(/^https?\:/,"").replace(/\-(medium|large)(\.[a-z]+)$/,"-small$2"),url:a.image,width:c[0],height:c[1]}]}},displayRichMedia:function(a){var c=a[1],b=this.slideshareUploader.STATE,d=a[2],g={};switch(a[0]){case b.UploadActive:this.isValid=!1;this.richMediaJson.uploadType=d.type;this.$slideshareForm.addClass("is-active");break;case b.UploadProgressStart:this.errorMessageModule&&
this.errorMessageModule.removeErrorMessage();this.previewModule.showLoader(this.$slideshareForm);e(document).trigger("previewLoading");break;case b.UploadProgressEnd:"image"===this.richMediaJson.uploadType&&(this.richMediaJson.availableSizes=d.available_sizes);c===b.UploadProgressEnd&&(e.isArray(d)&&!d.length)&&this.displayRichMedia([b.UploadError,b.UploadProgressEnd,{msg:"Upload Failure"}]);break;case b.UploadImageComplete:this.richMediaJson.imageDetails=d;this.constructImageJson(d);e(document).trigger("previewLoaded");
this.previewModule.$targetEl.removeClass("loading");this.isPreviewRendered=this.isValid=!0;break;case b.UploadPreview:this.isPreviewRendered=this.isValid=!0;"presentation"===this.richMediaJson.uploadType&&d.url?(this.richMediaJson.presentationDetails=d,a=this.constructDocumentPresentationJson(d),this.renderRichMedia(a,this._config.presentationCondensedTemplate),e("#article-preview-container .rich-media.presentation").one("click","a.image",f.bind(this.renderPresentationDetails,this)),e(document).trigger("previewLoaded")):
"document"===this.richMediaJson.uploadType&&(this.richMediaJson.documentDetails=d,this.richMediaJson.documentDetails&&void 0!==this.richMediaJson.documentDetails.url&&(a=this.constructDocumentPresentationJson(d),this.renderRichMedia(a,this._config.documentTemplate),e(document).trigger("previewLoaded")));break;case b.UploadError:this.previewModule.reset();this.isValid=!0;this.isPreviewRendered=!1;this.errorMessageModule||(this.errorMessageModule=new m({targetSelector:".postmodule-error-message-container"}));
this.errorMessageModule.removeErrorMessage();switch(d.type){case "size":g.template="sharebox-static/templates/share-common/_rich-media-uploader-size-error";break;case "type":g.template="sharebox-static/templates/share-common/_rich-media-uploader-type-error";g.dialog={el:"#supported-filetypes-dialog",title:"Supported File Types",template:"sharebox-static/templates/share-common/_supported-filetypes-dialog"};break;case "health":g.template="sharebox-static/templates/share-common/_rich-media-uploader-health-error";
break;default:g.template="sharebox-static/templates/share-common/_rich-media-uploader-error"}this.$root.find(".postmodule-container").addClass("error");this.errorMessageModule.displayErrorMessage(g);this.resetSlideshareUploader();e(document).trigger("previewError")}},getFormData:function(){var a,c=this.richMediaJson.uploadType,b=this.richMediaJson[c+"Details"];this.isPreviewRendered&&(a=[{name:"content.image.url",value:b.image},{name:"content.url",value:b.url},{name:"content.fileEx",value:b.extension},
{name:"content.fileId",value:b.id},{name:"content.url",value:b.url}],"document"===c||"presentation"===c)&&(c=b.description?b.description:b.summary,a.push({name:"content.title",value:b.title}),a.push({name:"content.description",value:c}));return a},renderPresentationDetails:function(a){var c=this,b=a.currentTarget.href;a.stopPropagation();a.preventDefault();this.previewModule.showLoader();e.getJSON("//api.embed.ly/1/oembed?"+e.param({key:"b8949c0eb73c11e089614040d3dc5c07",url:b,width:"625",height:"416",
autoplay:!0,secure:0<=location.protocol.indexOf("https")})+"\x26callback\x3d?",function(a){e("#article-preview-container").addClass("presentation-expanded");a.url=b;a.description=c.richMediaJson.presentationDetails.summary;c.renderRichMedia(a,c._config.presentationTemplate)})},renderRichMedia:function(a,c){this.previewModule.previewTemplate=c;this.previewModule.render(a)},reset:function(){this.previewModule.reset();this.richMediaJson={};this.errorMessageModule&&this.errorMessageModule.removeErrorMessage();
this.resetSlideshareUploader()},resetSlideshareUploader:function(){this.slideshareUploader.reset()},updatePreviewData:function(a){this.richMediaJson&&(this.richMediaJson[this.richMediaJson.uploadType+"Details"][a.name]=a.value)}}});LIModules.exports("RichMediaUploaderPlugin",h)})();(function(){function k(){f.find(".postmodule-submit").prop("disabled",function(b,d){return!d}).is(":disabled")&&g.one("change",k)}function l(){var b=this,d=f.find(".postmodule-submit"),a;dust.render(this._config.templateBasePath+"share-common/_submit-for-review-button",{},function(c,b){c||(a=e(b))});d.after(a);d.detach();g.one("change",function(){a.after(d);a.detach();b.errorMessageModule.removeErrorMessage()})}var e=LIModules.requires("jquery"),b=LIModules.requires("underscore"),h=LIModules.requires("BaseControl"),
m=LIModules.requires("Events"),n=LIModules.requires("Validatable"),p=LIModules.requires("fiber"),q=LIModules.requires("ErrorMessageModule"),f,g,h=h.extend(function(h){var d={rootSelector:".postmodule",textSelector:".postmodule-text",postModuleForm:".postmodule-container",submitURL:"/sharing/share?trk\x3dONSITE_OZ_SHAREBOX",errorMessageSelector:".postmodule-error-message-container",templateBasePath:"sharebox-static/templates/",EVENT_CHANNEL:"postmodule",showVisibilityToggle:!0};return{eventChannel:"postmodule",
addPlugin:function(a){this._plugins.push(a);a.configure(this)},addValidations:function(){var a=this;this.addValidation(function(){return!(!a.getPluginFormData().length&&!e.trim(g.val()))})},attachEventListeners:function(){f=e(this._config.postModuleForm);f.on("submit",b.bind(this._submitPost,this))},beforeDecoration:function(){b.defaults(this._config,d);this._plugins=[];this._config.EVENT_CHANNEL&&(this.eventChannel=this._config.EVENT_CHANNEL);g=e(this._config.textSelector);g.innerHeight();p.decorate(this,
n);this.addValidations()},getPluginFormData:function(){return b.reduce(this._plugins,function(a,c){var d;b.isFunction(c.getFormData)&&(d=c.getFormData())&&(a=a.concat(d));return a},[])},handleError:function(a){var c={DUPLICATE_POST:{template:this._config.templateBasePath+"share-common/_postmodule-duplicate-post-error"},CONTENT_BLOCKED_ERROR:{template:"common-templates/error-messages/content-blocked",callback:k},CONTENT_TO_BE_REVIEWED_ERROR:{template:"common-templates/error-messages/content-to-be-reviewed",
callback:b.bind(l,this)},error:{template:"common-templates/error-messages/generic"}};a=c[a]||c.error;this.errorMessageModule||(this.errorMessageModule=new q({targetSelector:this._config.errorMessageSelector}));this.errorMessageModule.removeErrorMessage();f.addClass("error");this.errorMessageModule.displayErrorMessage({template:a.template,callback:a.callback});this.sendEvent("error")},reset:function(){this.errorMessageModule&&this.errorMessageModule.removeErrorMessage();b.each(this._plugins,function(a){b.isFunction(a.reset)&&
a.reset()});this.sendEvent("reset")},sendEvent:function(a,c){m.trigger(this.eventChannel+"."+a,c)},validatePlugins:function(){return b.every(this._plugins,function(a){return a.validate()})},_submitPost:function(a){var c=this,d=e(a.target);a.preventDefault();this.validate()&&this.validatePlugins()&&(a=this.getPluginFormData(),c.sendEvent("submitting"),e.ajax(d.attr("action")||this._config.submitURL,{type:"POST",data:b.map(d.serializeArray().concat(a),function(a){"string"==typeof a.value&&(a.value=
a.value.replace(/\r\n?/g,"\n"));return a})}).done(function(a){a.success?(c.reset(),c.sendEvent("submit",{activityId:a.data.activityId})):(c.sendEvent("submit-fail"),c.handleError(a.status))}).fail(function(a,b,d){b="error";c.sendEvent("submit-fail");try{b=JSON.parse(a.responseText).status}catch(e){}c.handleError(b)}))}}});LIModules.exports("PostModule",h)})();(function(){var d=LIModules.requires("jquery"),e=LIModules.requires("underscore"),g=LIModules.requires("PostModulePlugin").extend(function(c){return{init:function(a){c.init.apply(this,arguments);this.$el=d(a.rootSelector);this.dustTmpl=a.dustTmpl||"sharebox-static/templates/share-common/_postmodule-oon-mentions-error";this.isValid=!0},addValidator:function(){var a=this;this.addValidation({test:function(){return a.isValid},error:function(){}})},configure:function(a){c.configure.call(this,a);this.$mentionsTypeahead=
this.$el.find(".mentions-typeahead");this.$mentionsEntities=this.$el.find(".mentions-entities");this.$shareNetworkVisibilty=this.$el.find("#share-with-combo-select");this.$submitButton=this.$root.find(".postmodule-submit");this._initializeEvents();this.addValidator()},reset:function(){this.$el.find(".post-module-text-error .oon-mentions-error").empty()},getIsValid:function(){return this.isValid},_initializeEvents:function(){this.$mentionsEntities.on("change",this._validate.bind(this));this.$shareNetworkVisibilty.on("change",
this._validate.bind(this))},_renderPartial:function(a){var b=this.$el;dust.render(this.dustTmpl,{invalidMentions:0<a.length,oonMentionees:a,typeOfMessage:"error"},function(a,f){b.find(".post-module-text-error .oon-mentions-error").replaceWith(f)})},_validate:function(){var a=this.isValid,b=[],c=JSON.parse(d.trim(this.$mentionsEntities.val())||"[]");"CONNECTIONS"===this.$shareNetworkVisibilty.val()&&(b=e.filter(c,function(a){return"member"===a.type&&!a.isFirstDegree}));this.isValid=0===b.length;a!==
this.isValid&&this.$el.trigger("validationChange");this._renderPartial(b)}}});LIModules.exports("MentionsValidityPlugin",g)})();